{% extends "layout.html" %}
{% load static %}

{% block body %}
<div class="container-fluid">


    <div class="d-sm-flex justify-content-between align-items-center mb-4">
        <h3 class="text-dark mb-0">FLC</h3>
        <!-- <a class="btn btn-primary btn-sm d-none d-sm-inline-block" role="button" href="#"><i class="fas fa-download fa-sm text-white-50"></i>&nbsp;Generate Report</a> -->

    </div>


</div>

<div class="container-fluid">
    <div class="card">
        <div id="result" class="card-body">

            <div class="table-responsive table mt-2" id="dataTable-1" role="grid" aria-describedby="dataTable_info">
                <table class="table my-0" id="InvTable">
                    <thead>
                        <tr>

                            <th>Statut</th>
                            <th>Réference</th>
                            <th>Nombre de Bac</th>
                            <th>Zone de KIT</th>
                            <th>SM CSC</th>
                            <th>Code Condi</th>
                            <th>Qte UC</th>
                            <th>Date</th>
                            <th>heure</th>
                            <th>Moniteur</th>
                            <th>HFA</th>
                        </tr>
                    </thead>
                    {% if alertesF %}
                    {% for alert in alertesF %}

                    <tr id="alert-{{alert.id}}">

                        <td class="ms-vb2"><button class="btn btn-info form-control ms-vb2" id="btn1"
                                onClick="editUser({{alert.id}})" data-toggle="modal"
                                data-target="#myModal">{{alert.statut}}</button></td>



                        <td class="réf invData ms-vb2" name="Reference">{{alert.Reference}}</td>
                        <td class="nbrbac invData ms-vb2" name="Nombre_De_Bac">{{alert.Nombre_De_Bac}}</td>
                        <td class="zkit invData ms-vb2" id="zkit" name="Zone_De_Kit">{{alert.Zone_De_Kit}}</td>
                        <td class="smcsc invData ms-vb2" id="smcsc" name="SM_Csc">{{alert.SM_Csc}}</td>

                        <td class="smcsc invData ms-vb2 " id="smcsc" name="code_condi">{{alert.Code_condi}}</td>
                        <td class="smcsc invData ms-vb2 " id="smcsc" name="qte UC">{{alert.QTe_Uc}}</td>


                        <td class="date invData ms-vb2 " id="date" name="Date">{{alert.Date}}</td>
                        <td class="heure invData ms-vb2 " id="heure" name="heure">{{alert.heure}}</td>
                        <td class="moniteur invData ms-vb2 " id="moniteur" name="moniteur">{{alert.Moniteur}}</td>
                        <td class="moniteur invData ms-vb2 " id="HFA" name="HFA">{{alert.HFA}}</td>




                        <!--<td><button class="btn btn-primary" onClick="deleteUser({{inv.id}})" style="background: rgb(252,2,2);">Supprimer</button></td> -->

                    </tr>
                    {% endfor %}
                    {% else %}
                    <h3 style="color: crimson; text-align: center; "> Aucune Alertes Trouvé </h3>
                    {% endif %}

                </table>
            </div>


        </div>
    </div>
</div>
</div>
<!-- modals ----------------------------------------------------------------------------------------------------------->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Alertes</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>



            </div>
            <form id="updateAlertes" action="">

                <div class="modal-body">
                    <input class="form-control" id="form-id" type="hidden" name="formId" />
                    <label for="statut">Statut: </label>

                    <select name="formStatut" id="form-statut" class="custom-select custom-select-sm"
                        onchange="change1()">


                        <optgroup label="">

                            <option value=""></option>
                            <!--
                                                <option value="Train">Sortie Train</option>
                                                <option value="Alerte">Alerte</option>
                                                <option value="A_Tranche">Anticipation par Tranche</option>
                                                <option value="A_Remorque">Anticipation par Remorque</option>
                                                <option value="FLC">FLC</option>
                                                <option value="Livré">Livré</option>
                                                <option value="Non_T">NON Trouvé</option>
                                                <option value="A_Débord">Au Débord</option>
                                                -->
                            <option value="FLC_T">FLC traitée</option>
                            
                            


                        </optgroup>
                    </select>



                    <label for="comment">Commentaire:</label>

                    <input class="form-control" id="form-comment" type="text" name="formComment" />

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Sauvegarder</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>

            </form>

        </div>
    </div>
</div>
<!-- end of modals ------------------------------------------------------------------------------------------------------>
{% endblock %}

{% block javascript %}
<script>

    // Create Django Ajax Call
    $("form#updateAlertes").submit(function () {


        var idInput = $('input[name="formId"]').val().trim();
        var Statutinp = document.getElementById("form-statut").value;
        var commenataireInput = $('input[name="formComment"]').val().trim();


        //var hfa = d.toLocaleTimeString('it-IT');

        if (Statutinp && commenataireInput) {
            // Create Ajax Call
            $.ajax({
                url: '{% url "GA_UEP:update_FLC" %}',
                data: {
                    'id': idInput,
                    'statut': Statutinp,
                    'Commenataire': commenataireInput,


                },
                dataType: 'json',
                success: function (data) {
                    alert("L'Alerte est traitée ");
                }
            });
        } else {
            alert("Tous Les champs doivent avoir une valeur Valide.");
        }
        $('form#updateAlertes').trigger("reset");
        $('#myModal').modal('hide');
        return false;
    });

    function editUser(id) {
        if (id) {
            tr_id = "#alert-" + id;
            $('#form-id').val(id);

        }
    }






    $(document).ready(function () {
        $('td.ms-vb2').each(function (index) {
            var c = $(this).find('#btn1').text()
            if (c === 'Livré' || c === 'Train') {
                $(this).find('#btn1').css("background-color", "lawngreen");
            }
            if (c === 'Non_T' || c === 'Alerte' || c === 'A_Débord') {
                $(this).find('#btn1').css("background-color", "darkorange");
            }
            if (c === 'A_Remorque' || c === 'A_Tranche') {
                $(this).find('#btn1').css("background-color", "fuchsia");
            }
            if (c === 'FLC') {
                $(this).find('#btn1').css("background-color", "red");
            }
        });
    });




</script>

{% endblock javascript %}